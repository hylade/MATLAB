### 层次分析法

#### 构建步骤

1. 建立层次结构模型
2. 构造判断（成对比较）矩阵（主观考虑）
3. 层次单排序及其一致性检验
4. 层次总排序及其一致性检验



####层次结构图

最高层：决策的目的、要解决的问题

最底层：决策时的备选方案

中间层：考虑的因素、决策的原则



#### 成对比较矩阵

##### 一致矩阵法

1. 不把所有因素放在一起比较，而是两两相互比较
2. 对此时采用相对尺度，以尽可能减少性质不同的诸因素相互比较的困难，以提高准确度

成对比较矩阵是表示本层所有因素针对上一层某一个因素的相对重要性的比较，其矩阵元素通过 Santy 的 1-9 标度方法给出



#### 成对比较矩阵标度表

|  标度   |                             含义                             |
| :-----: | :----------------------------------------------------------: |
|    1    |              表示两个因素相比，具有同样的重要性              |
|    3    |        表示两个因素相比，一个因素比另一个因素稍微重要        |
|    5    |        表示两个因素相比，一个因素比另一个因素明显重要        |
|    7    |        表示两个因素相比，一个因素比另一个因素强烈重要        |
|    9    |        表示两个因素相比，一个因素比另一个因素极端重要        |
| 2,4,6,8 |                     上述两相邻判断的中值                     |
|  倒数   | 因素 i 与 j 比较的判断 aij ，则因素 j 与 i 比较的判断 aji = 1 / aij |



#### 一致性检验

如 $a_{21} = 2(C_2:c_1)$,$a_{13} = 4(C_1:C_3)$,那么应该得到$a_{23} = 8(C_2:C_3)$

但一般都是允许不一致，却需要确定不一致的允许范围



#### 示例：旅游问题

##### 建模

Z 表示选择的目的地； A1 - A5 分别表示景色、费用、居住、饮食、旅途； B1 - B3 分别表示苏杭、北戴河、桂林三个地点

##### 构造成对比较矩阵

按照主观想法，构建 A 中因素在 Z 上的相互比重及 B 中因素在 A1 - A5 上的相互比重

$$A = \begin{bmatrix} 1 & 1/2 & 4&3&3\\ 2 &1&7&5&5\\1/4&1/7&1&1/2&1/3\\1/3&1/5&2&1&1\\1/3&1/5&3&1&1&\end{bmatrix}$$

比如第 1 行第 3 列表示：对于 Z 目的地选择， A1 与 A3 的比值是 4 ，根据标度表可知含义

$$B_{1} = \begin{bmatrix} 1&2&5\\1/2&1&2\\1/5&1/2&1\end{bmatrix}$$

$$B_{2} = \begin{bmatrix} 1&1/3&1/8\\3&1&1/3\\8&3&1\end{bmatrix}$$

$$B_{3} = \begin{bmatrix} 1&1&3\\1&1&3\\1/3&1/3&1\end{bmatrix}$$

$$B_{4} = \begin{bmatrix} 1&3&4\\1/3&1&1\\1/4&1&1\end{bmatrix}$$

$$B_{5} = \begin{bmatrix} 1&1&1/4\\1&1&1/4\\4&4&1\end{bmatrix}$$

比如第 1 个矩阵中的第 2 行 第 3 列元素表示：对于 A1 景色方面，B2（北戴河）与 B3（桂林）的比值是2，根据标度表可知含义

##### 求解权重并检查一致性

通过 .m 文件对相应的 A 或 B1 - B5 矩阵进行分析，得到各个选项的比重并可检查一致性

```matlab
>> CCFX
请输入判断矩阵A(n阶)
A=[1, 1/2, 4, 3, 3;
 2, 1,   7, 5, 5;
 1/4, 1/7, 1, 1/2, 1/3;
 1/3, 1/5, 2, 1, 1;
 1/3, 1/5, 3, 1, 1;]
    0.2636
    0.4758
    0.0538
    0.0981
    0.1087

此矩阵的一致性可以接受!
CI=
    0.0180

CR=
    0.0161
% 可知此矩阵的一致性满足要求，并且得到 5 个数值，比如数字 3 为 0.0538 ，说明 A3（居住）条件对目的地选择影响为 0.0538 ，可知影响不大

% -------------------------------------------------------------------------------------------------
>> CCFX
请输入判断矩阵A(n阶)
A=[1,1,3;
1,1,3;
1/3,1/3,1;]
    0.4286
    0.4286
    0.1429

此矩阵的一致性可以接受!
CI=
     0

CR=
     0
% 当输入矩阵 B3 时得到如此结果，说明矩阵一致性满足要求，同时对于 A3（居住）因素， B1 和 B2 的影响较大， B3 较小，换言之，就是 B1 和 B2 的居住条件优于 B3
```

由此方法，权重如下：

A1 - A5 对 Z 的权重为 [0.2636, 0.4758, 0.0538, 0.0981, 0.1087]

B1 - B3 对 A1 的权重为 [0.5954, 0.2764， 0.1283]

B1 - B3 对 A2 的权重为 [0.0819, 0.2363， 0.6817]

B1 - B3 对 A3 的权重为 [0.4286, 0.4286， 0.1429]

B1 - B3 对 A4 的权重为 [0.6337, 0.1919， 0.1744]

B1 - B3 对 A5 的权重为 [0.1667, 0.1667， 0.6667]



由此根据 "[一致性检验](#一致性检验)" 章节中内容便可知 B1 - B3 对总目标的影响，如 B1 对总目标的权值：

0.595 * 0.263 + 0.082 * 0.475 + 0.429 * 0.055 + 0.633 * 0.099 + 0.166 * 0.110 = 0.3

同理可知 B2 和 B3 对总目标的权值分别是 0.245 和 0.455

故决策层对总目标的权向量为 {0.3, 0.245, 0.455}，应该选择 B3(桂林) 为旅游目的地

:smiley:==需要注意当成对比较矩阵无法正确构造时，层次分析法的结果将难以满足要求；并且一般不作为主要问题的解决方法进行使用，而是作为子问题的解决方案进行使用==



### 多属性决策

#### 加权算术平均算子（WAA）

设函数 $WAA:R^n \to R$，$(a_1,a_2,L,a_n)$是一组给定的数据，若$WAA_w(a_1,a_2,L,a_n) = \sum \limits_{j=1}^nw_ja_j$

其中 $w=(w_1,w_2,L,w_n)^T$是数据$(a_1,a_2,L,a_n)$的权重向量，$w_j\in \begin{bmatrix} 0,1\end{bmatrix},1 \leq j\leq n,\sum \limits_{j=1}^n = 1$，R为实数集，则称函数 WAA 为加权算术平均算子

实例：某四项指标的得分分别为 (91, 82, 83, 93) ，四项指标的权重分别为 (0.4, 0.1, 0.2, 0.3)^T ，则加权平均综合得分为：

$$WAA_w(91, 82, 83, 93) = 91 \times0.4+82\times0.1+83\times0.2+93\times0.3=89.1$$



##### 属性类型

一般有效益型、成本型、固定型、偏离型、区间型、偏离区间型等

效益型属性是指属性值越大越好的属性

成本型属性是指属性值越小越好的属性

固定型属性是指属性值越接近某个固定值$\alpha_i$越好的属性

偏离型属性是指属性值越偏离某个固定值$\beta_i$越好的属性

区间型属性是指属性值越接近某个固定区间$\begin{bmatrix} q_1^j,q_2^j\end{bmatrix}$（包括落入该区间）越好的属性

偏离区间型属性是指属性值越偏离某个固定区间$\begin{bmatrix} q_1^j,q_2^j\end{bmatrix}$越好的属性



##### 属性值的归一化处理

:crossed_swords:为消除不同==物理量纲==对决策结果的影响，可进行如下规范化处理：

1. 当属性值为效益型，则令$r_{ij} = \frac{a_{ij}}{\max a_{ij}}$或$r_{ij} = \frac{a_{ij}-\min a_{ij}}{\max a_{ij} - \min a_{ij}}$
2. 当属性值为成本型，则令$r_{ij} = \frac{\min a_{ij}}{a_{ij}}$或$r_{ij} = \frac{\max a_{ij}- a_{ij}}{\max a_{ij} - \min a_{ij}}$
3. 当属性值为固定型，则令$r_{ij} = 1-\frac{a_{ij}-a_j}{\max|a_{ij} -a_j|}$
4. 当属性值为偏离型，则令$r_{ij} = |a_{ij}-\beta_j|-\frac{\min |a_{ij} - \beta_j|}{\max|a_{ij}-\beta_j|-\min|a_{ij}-\beta_j|}$
5. 当属性值为区间型，则令$r_{ij} = \begin{cases} 1-\frac{\max(q_1^j-a_{ij},a_{ij}-q_2^j)}{\max(q_1^j-\min a_{ij},\max a_{ij}-q_2^j)},&a_{ij}\notin [q_1^j,q_2^j] \\1,&a_{ij}\in [q_1^j,q_2^j] \end{cases}$
6. 当属性值为偏离区间型，则令$r_{ij} = \begin{cases} \frac{\max(q_1^j-a_{ij},a_{ij}-q_2^j)}{\max(q_1^j-\min a_{ij},\max a_{ij}-q_2^j)},&a_{ij}\notin [q_1^j,q_2^j] \\0,&a_{ij}\in [q_1^j,q_2^j] \end{cases}$



#### 多属性决策模型实例

对四家企业进行投资，针对产值、投资成本、销售额、国家收益比重、环境污染程度共 5 相项指标进行评估，如下表所示。各项指标汇总，投资成本、环境污染程度为成本型，其他为效益型。属性权重未知，求最佳投资方案

|      |  u1   |  u2  |  u3  |  u4  |  u5  |
| :--: | :---: | :--: | :--: | :--: | :--: |
|  x1  | 8350  | 5300 | 6135 | 0.82 | 0.17 |
|  x2  | 7455  | 4952 | 6527 | 0.65 | 0.13 |
|  x3  | 11000 | 8001 | 9008 | 0.59 | 0.15 |
|  x4  | 9624  | 5000 | 8892 | 0.74 | 0.28 |



##### 归一化处理

按照"[属性值的归一化处理](#属性值的归一化处理)"章节中的方法，对上表数据进行归一化处理，如第 2 列投资成本属于成本型，对于第 2 列第 1 行数据归一化处理为：$r_{ij} = \frac{\min a_{ij}}{a_{ij}}=\frac{4952}{5300}=0.9343$

如第 1 列产值属于效益型，对于第 1 列第 4 行数据归一化处理为：$r_{ij} = \frac{a_{ij}}{\max a_{ij}}=\frac{9624}{11000}=0.8749$

故归一化处理后的决策矩阵为：

|      | u1     | u2     | u3     | u4     | u5     |
| ---- | ------ | ------ | ------ | ------ | ------ |
| x1   | 0.7455 | 0.9343 | 0.6811 | 1.0000 | 0.7647 |
| x2   | 0.6777 | 1.0000 | 0.7246 | 0.7926 | 1.0000 |
| x3   | 1.0000 | 0.6189 | 1.0000 | 0.7195 | 0.8667 |
| x4   | 0.8749 | 0.9904 | 0.9871 | 0.9024 | 0.4643 |



##### 计算属性权重

通过自我评价或专家评价的方式，构建成对比较矩阵，再通过层次分析法中相应的 .m 文件进行计算属性权重

:small_blue_diamond:此处假定 $A = \begin{bmatrix} 1 & 3 & 3&3&3\\ 1/3 &1&1&1&1\\1/3&1&1&1&1\\1/3&1&1&1&1\\1/3&1&1&1&1&\end{bmatrix}$

如 A 矩阵第 1 行 第 2 数据表示产值相对于投资成本的比值为 3 ，通过"[成对比较矩阵标度表](#成对比较矩阵标度表)"得知含义



通过计算得到产值、投资成本、销售额、国家收益比重、环境污染程度的权重分别为 [0.4286, 0.1429, 0.1429, 0.1429, 0.1429]



##### 由属性权重和属性值计算总得分

如企业 x1 的总得分为：$WAA_w(a_1,a_2,L,a_n) = \sum \limits_{j=1}^nw_ja_j = 0.7455\times0.4286+0.9343\times0.1429+0.6811\times0.1429+\\1.0000\times0.1429+0.7647\times0.1429$

由此可得各个企业的总得分为 [0.80, 0.79, 0.89, 0.85] ，故应投资企业 3



###灰色预测

通过少量的、不完全的信息建立数学模型并做出预测的一种预测方法



#### 灰色系统理论

是研究解决灰色系统分析、建模、预测、决策和控制的理论



#### 灰色预测

是对灰色系统所做的预测，常用的方法（如回归分析等）需要较大的样本，若样本较小，常造成较大误差，使预测目标失效。优点在于建模所需的建模信息少，运算方便，建模精度高



#### 灰色系统简介

灰色系统是黑箱概念的一种推广。将既含有已知信息又含有未知信息的系统称为灰色系统

作为两个极端，将信息完全未确定的系统称为黑色系统；将信息完全确定的系统称为白色系统

:question:区别白色系统和黑色系统的==重要标志==：系统各因素之间是否有确定的关系



####灰色系统特点:man_with_turban:

1. 用灰色数学处理不确定量，使之量化
2. 充分利用已知信息寻求系统的运动规律
3. 灰色系统理论能处理贫信息系统



#### 灰色生成

将原始数据列中的数据，按某种要求作数据处理称为生成

常用的方式有：累加生成、累减生成、均值生成、级比生成



#### 累加生成

即通过数列间各时刻数据的依个累加以得到新的数据和数列；使灰色过程由灰变白的一种方法

累加前的数列称为原始数列，累加后的数列称为生成数列



#### 累加生成简介

原始数据：$x^{(0)} = \{x^{(0)}(1), x^{(0)}(2), \Lambda, x^{(0)}(N)\} = \{6, 3, 8, 10, 7\}$

累加生成后得到新序列$x^{(1)} = \{6,9,17,27,34\}$

新序列中的第 1 个数值：$x^{(1)}(1)  = x^{(0)}(1) = 6$

新序列中的第 3 个数值：$x^{(1)}(3) = x^{(0)}(1) + x^{(0)}(2)+x^{(0)}(3)=6+3+8=17$



:call_me_hand:归纳上式，得$x^{(1)}(i) = \{\sum \limits_{j=1}^i x^{()0}(j) |i=1,2L,N\}$

称此式所表达的数据列为原始数据列的一次累加生成，简称为一次累加生成



#### GM（1， 1）模型

灰色系统是对离散序列建立的微分方程， GM(1.1) 是一阶微分方程模型，其形式为：

$$\frac{dx}{dt}+ax=u$$

离散形式和预测公式分别为下式的左右侧：

$$\Delta^{(1)}(x^{(1)}(k+1))+a(x(k+1))=u \hat{a}^{(1)}(k+1)=[x^{(1)}(1)-\frac{\hat{u}}{\hat{a}}]e^{\hat{a}k}+\frac{\hat{u}}{\hat{a}}$$



同时在化简过程中可知$x^{(0)}(k+1)=a[-\frac{1}{2}(x^{(1)}(k)+x^{(1)}(k+1))]+u$



#### GM(1, 1) 模型精度检验

一般有三种方法：相对误差大小检验法、关联度检验法和后验差检验法



#### 后验差检验法

设按 GM(1， 1) 建模法已求出 $\hat{X}^{(1)}$，并将$\hat{X}^{(1)}$做一次累减，转化为$\hat{X}^{(0)}$，即

$\hat{X}^{(0)}=[\hat{x}^{(0)}(1), \hat{x}^{(0)}(2), n, \hat{x}^{(0)}(n)]$

计算残差为：$e(k) = x^{(0)}(k)-\hat{x}^{(0)}(k),k=1,2,L,n$

求出原始序列 $X^{(0)}$ 及残差序列 E 的方差分别为 $S_1^2$ 和 $S_2^2$

$$S_1^2=\frac{1}{n}\sum \limits_{k=1}^n[x^{(0)}(k)-\overline{x}]^2$$

$$S_2^2=\frac{1}{n}\sum \limits_{k=1}^n[e(k)-\overline{e}]^2$$

其中， $\overline{x}=\frac{1}{n}\sum \limits_{k=1}^n x^{(0)}(k)$ ， $\overline{e}=\frac{1}{n}\sum \limits_{k=1}^n e(k)$

得==后验差之比==为 $C=S_2/S_1$

==指标 C 和 p 是后验差检验的两个重要指标。指标 C 越小越好， C 越小表示 S1 大而 S2 小； S1 大表示原始数据方差大，即原始数据离散程度大； S2 小表示残方差小，即残方差离散程度小。 C 小说明尽管原始数据很离散，而模型所得计算值与实际值之差并不太离散==



#### 精度检验等级参照表

|  模型精度等级  |  均方差比值 C   |
| :------------: | :-------------: |
|   1 级（好）   |    C <= 0.35    |
|  2 级（合格）  | 0.35 < C <= 0.5 |
|  3 级（勉强）  | 0.5 < C <= 0.65 |
| 4 级（不合格） |    0.65 < C     |



#### 示例：灰色预测

通过 .m 文件运行相应的一维数据即可



### 图论模型-Dijkstra 算法

Dijkstra 算法能够用于求解一个顶点到另一个顶点的最短路径，或者是初始点到其他所有顶点的最短路径

该算法是一种标号法：给赋权图的每一个顶点记一个数，称为顶点的标号（临时标号，称为 T 标号，或者固定标号，称为 P 标号）。 T 标号表示从初始点到该顶点的最短路长的商界； P 标号则是从初始点到该顶点的最短路长



#### 算法步骤

1. 给顶点 v1 标 P 标号 d(v1) = 0, 给顶点 vj(j = 2, 3, n, n) 标 T 标号 $d(v_j) = l_{1j}$
2. 在所有 T 标号中取最小值，譬如， $d(v_{j0})=l_{1j_0}$ ，则把 $v_{j_0}$ 的 T 标号改为 P 标号，并重新计算具有 T 标号的其他个顶点的 T 标号：选顶点 $v_j$ 的 T 标号 $d(v_j)$ 与 $d(v_{j_0}) + l_{j_0j} $ 中较小者作为 $v_j$ 的新的 T 标号
3. 重复上述步骤，直到目标顶点的标号改为 P 标号

简单来说就是将初始点定为 0 ，再将与之相邻未被标 P 标号的最近的点编号，并标注其间距离值，再搜索这两个点相邻的未被标 P 标号的最近的点，将其编号并标注距离值，直到目标节点。此时目标节点的距离值便为最小值，其路径可以逆推求得



#### 带权邻接矩阵

是表示顶点之间相邻关系的矩阵

$$\begin{bmatrix} 0 &2&8&1&\inf&\inf&\inf\\...\\...\end{bmatrix}$$

第 1 行第 1 列表示本节点与本节点之间的距离，肯定为 0

第 1 行第 3 列表示 1 节点 与 3 节点之间的距离为 8 ，并且为直接连接

第 1 行 第 5 列表示 1 节点与 5 节点之间不能直接连接，距离假定为无穷大

==上述情况适用于无向图==

若对于==有向图和混合图==，则需要考虑箭头方向和无箭头直线



#### 示例

分为主程序和子程序，需要分别保存为 .m 文件（在保存时需要注意，由于主程序中需要使用子程序，所以需要将子程序命名为主程序中函数的使用名称）

对于不同的邻接矩阵，只需要修改主程序中矩阵大小即可；并对 dijkstra 函数中的后两个参数进行修改，能够返回不同起始点到目标终止点的最小距离



### 图论模型-Floyd 算法

#### 算法的思想原理

Floyd 算法是一种经典的动态规划算法。目标是寻找从点 i 到点 j 的最短路径

从任意节点 i 到任意节点 j 的最短路径不外乎 2 种可能， 1 是直接从 i 到 j ， 2 是从 i 经过若干个节点 k 到 j 。所以，假设 Dis(i, j) 为节点 u 到 v 的最短路径的距离，对于每一节点 k ，都检查 Dis(i, k) + Dis(k j) < Dis(i, j) 是否成立，若成立，证明从 i 到 k 再到 j 的路径比 i 直接到 j 的路径短，当遍历完所有节点 k ，Dis(i, j) 中记录的便是 i 到 j 的最短路径的距离



#### 示例

分为主程序和子程序，需要分别保存为 .m 文件（在保存时需要注意，由于主程序中需要使用子程序，所以需要将子程序命名为主程序中函数的使用名称）

对于不同的邻接矩阵，只需要修改主程序中矩阵大小或元素即可

对于求得的结果，需要先使用 path 矩阵求得相应的路径，如原矩阵求得的 path 矩阵如下：

$$\begin{bmatrix} 1&6&5&5&5&6\\6&2&3&4&4&6\\ 5&2&3&4&5&4\\ 5&2&3&4&5&6 \\1&4&3&4&5&1 \\ 1&2&4&4&1&6\end{bmatrix}$$

比如， 2 到 5 的路线，便在该矩阵中找第 2 行 第 5 列，结果为 4 ，说明，若想从 2 到 5 ，必须先到 4 ，便再从第 4 行找，发现 (4, 5) = 5 ，完成；路线为 2 - 4 - 5

通过路径 (2, 5) 便直接可以在 D 矩阵中找到相应的值



### 模拟退火算法

模仿自然界退火现象而得，利用了物理中固体物质的退火过程与一般优化问题的相似性从某一初始温度开始，伴随温度的不断下降，结合概率突跳特性在解空间中随机寻找全局最优解



#### 模拟要求

1. 初始温度足够高
2. 降温过程足够慢
3. 终止温度足够低



####示例：模拟退火算法对 TSP 问题（旅行商问题）的求解

TSP 问题是指假设一个旅行商人要拜访 n 个城市，他必须要选择要走的路径，路径的限制是每个城市只能拜访一次，而且最后要回到原来出发的城市。路径的选择目标是要求得的路径为所有路径之中的最小值



##### 城市坐标

| 城市 | X 坐标 | Y 坐标 | 城市 | X 坐标 | Y 坐标 |
| :--: | :----: | :----: | :--: | :----: | :----: |
|  1   | 0.6683 | 0.2536 |  6   | 0.2293 | 0.7610 |
|  2   | 0.6195 | 0.2634 |  7   | 0.5171 | 0.9414 |
|  3   | 0.4000 | 0.4439 |  8   | 0.8732 | 0.6536 |
|  4   | 0.2439 | 0.1463 |  9   | 0.6878 | 0.5219 |
|  5   | 0.1707 | 0.2293 |  10  | 0.8488 | 0.3609 |



##### :curly_loop:修改

只需要对主程序中 Coordinate（坐标）进行相应的修改，将 X 坐标和 Y 坐标都改为具体问题的值即可

输出的序号点与输出的坐标顺序是一一对应的

==但由于退火算法只能求得近似解，同时 TSP 问题也是一个无法精确求解的问题，所以求得的解各不相同，但都近似==



### 种群竞争模型

####模型假设

有甲乙两个种群，独自生存时数量变化均服从 Logistic 规律

$$\frac{dx}{dt} = r_1x(1-\frac{x}{N_1})$$ ，$$\frac{dy}{dt} = r_1x(1-\frac{y}{N_1})$$ 

两个种群一起生存时，乙对甲增长的阻滞作用与乙的数量成正比；甲对乙有同样作用

$$\frac{dx}{dt} = r_1x(1-\frac{x}{n_1}-s_1\frac{y}{n_2})$$

$$\frac{dy}{dt} = r_2y(1-\frac{y}{n_2}-s_2\frac{y}{n_1})$$

其中 x(t) , y(t) 分别为甲乙两种群的数量， r1 ， r2 为它们的固有增长率， n1 ， n2 为它们的最大容量； s1 的含义是对于供养甲的资源来说，单位数量的乙（相对 n2）的消耗为单位数量甲（相对 n1）消耗的 s1 倍， s2 同理



####示例

直接运行 .m 文件即可；由于代码中有 pause 命令，当完成第 1 幅图后，若点击任意键将生成第 2 幅图

当遇到具体问题时，可以对 .m 文件中的初始值进行修改



####应用

可以应用于不同企业推出的类似产品的销售情况；



### 排队论模型

#### 要素

1. 顾客输入过程
2. 排队结构与排队规则
3. 服务机构与服务规则



#### 顾客输入过程

顾客源（总体）： 有限 / 无限；（一般选择无限）

顾客到达方式： 逐个 / 逐批；（仅研究逐个情形）

顾客到达间隔：随机型 / 确定型；（一般选择随机型）

顾客前后到达是否独立： 相互独立 / 相互关联；（一般选择相互独立）

输入过程是否平稳： 平稳 / 非平稳；（仅研究平稳型）



#### 排队结构与排队规则

顾客排队方式： 等待制 / 即时制；

排队系统容量： 有限制 / 无限制；

排队队列数目： 单列 / 多列；

是否中途退出： 允许 / 禁止；

是否列间转移： 允许 / 禁止；

（仅研究禁止退出和转移的情形）



#### 服务机构与服务规则

服务台数目： 单个/ 多个；

服务台排列形式： 并列 / 串列 / 混合；

服务台服务方式： 逐个 / 逐批；（研究逐个情形）

服务时间分布： 随机型 / 确定型；

服务时间分布是否平稳： 平稳 / 非平稳；（研究平稳情形）



#### 服务台为顾客服务的顺序

1. 先到先服务（FCFS）（一般都是先到先服务）
2. 后到先服务（LCFS）
3. 随机服务
4. 优先服务



####到达间隔和服务时间典型分布

1. 泊松分布 M
2. 负指数分布 M
3. k 阶爱尔朗分布 Ek
4. 确定型分布 D
5. 一般服务时间分布 G



#### 系统运行状态参数

##### 系统状态 N(t) 

指排队系统在 t 时刻的全部顾客数，包括排队顾客数和正在被服务的顾客数



##### 系统状态概率

分为瞬态概率和稳态概率。瞬态概率 $P_n(t)$ 表示时刻 t 系统状态 N(t) = n 的概率；稳态概率 $P_n = \lim \limits_{t \to \infty}P_n(t)$ ，由于一般排队系统在运行了一定长的时间后，系统状态的概率分布不再随时间 t 变化，即初始时刻 (t = 0) 系统状态的概率分布 ($P_n(0),n >>0$) 的影响将消失



##### 系统运行指标参数

评价排队系统的优劣

1. 队长：系统中的顾客数 (n) 期望值为 $L_s$
2. 排队长：系统中排队等待服务的顾客数；期望值记为 $L_q$
3. 逗留时间：指一个顾客在系统中的全部停留时间；期望值记为 $W_s$ ，$W_s = W_q + E[服务时间]$
4. 等待时间：指一个顾客在系统中的排队等待时间；期望值记为 $W_q$
5. 忙期：指从顾客到达空闲服务机构起到服务机构再次空闲的时间长度
6. 忙期服务量：指一个忙期内系统评价完成服务的顾客数
7. 损失率：指顾客到达排队系统，未接受服务而离去的概率
8. 服务强度： $\rho = \frac{\lambda}{s\mu}$ ，其中 $\lambda$ 表示单位时间内到达系统的人数； $\mu$ 表示单个服务台单位时间内能够服务的人数； s 表示服务台个数



####顾客到达时间间隔分布——泊松流

若顾客到达满足一下条件，称为泊松流

1. 在不相互重叠的时间区间内，到达顾客数相互独立（无后效性）
2. 对于充分小的时间间隔 $[t, t + \Delta t]$ 内，到达 1 个顾客的概率与 t 无关，仅与时间间隔成正比（平稳性）： $P_1(t, t + \Delta t) = \lambda \Delta t + o(\Delta t)$
3. 对于充分小的时间间隔 $[t, t + \Delta t]$ ， 2 个及以上顾客到达的概率可以忽略不计（普通性）

若顾客到达时间间隔为泊松流，则服从负指数分布

此时到达时间间隔 T 的概率密度为

$$f_T(t) = \begin{cases} \lambda e^{-\lambda t},&t \geq 0\\ 0,&t< 0\end{cases}$$

分布函数为

$$F_T(t)=\begin{cases} 1-\lambda e^{-\lambda t},&t \geq0\\0,&t<0\end{cases}$$

此时 $E[T] = 1/\lambda$ ， $Var[T] = 1/\lambda^2]$ , $\sigma[T] = 1/\lambda$



#### 顾客服务时间分布——负指数分布

对一个顾客的服务时间 $T_s$ ，等价于相邻两个顾客离开排队系统的时间间隔。若 $T_s$ 服从负指数分布，其概率密度和分布函数分别为

$$f_{T_s}(t) = \begin{cases} \mu e^{-\mu t},&t \geq 0\\ 0,&t< 0\end{cases}$$

$$F_{T_s}(t)=\begin{cases} 1-\mu e^{-\mu t},&t \geq0\\0,&t<0\end{cases}$$

此时 $E[T_s] = 1/\mu$ ， $Var[T_s] = 1/\mu^2]$ , $\sigma[T_s] = 1/\mu$

$E[T_s] = 1/\mu$ 表示每个顾客的平均（期望）服务时间； $\mu$ 表示单位时间服务的顾客数，即平均（期望）服务率



#### 单服务台负指数分布 M/M/1 排队系统

#####模型条件

1. 输入过程：顾客源是无限的，顾客到达完全是随机的，单个到来，到达过程服从泊松分布，且是平稳的
2. 排队规则：单队，且队长没有限制，先到先服务
3. 服务机构：单服务台，服务时间的长短是随机的，服从相同的指数分布



##### 公式

$P_0 = 1-\rho$

$P_n=\rho^n(1-\rho)$

$L_s = \frac{\lambda}{\mu-\lambda}=\frac{\rho}{1-\rho}$

$L_q = \frac{\lambda^2}{\mu(\mu-\lambda)}=\frac{\rho^2}{1-\rho}=L_s\rho$

$W_s=\frac{1}{\mu-\lambda}$

$W_q = \frac{\lambda}{\mu(\mu-\lambda)} = W_s\rho$

$P(N>k) = \rho^{k+1}$



##### 示例 1

某医院急诊室同时只能诊治一个病人，诊治时间服从指数分布，每个病人平均需要 15 分钟，病人按泊松分布到达，平均每小时到达 3 人，试对此排队系统进行分析

1. 先确定参数值，由于这是单服务台系统，有 $\lambda = 3 人/h$ , $\mu=\frac{60}{15}=4人/h$

   所以服务强度为：$\rho = \frac{\lambda}{\mu}=3/4=0.75$

   计算稳态概率： $P_0=1-\rho=1-0.75=0.25$ ，这就是空闲概率，也就是病人不需要等待就能就诊的概率。而病人需要等待的概率为 $\rho=1-P_0=0.75$ ，即急诊室忙碌的概率

2. 计算系统主要工作指标

   通过"[公式](#公式)"章节中的公式应用，便可求得各个指标：

   急诊室内外的病人平均数： $L_s=3人$

   急诊室排队等待的病人平均数： $L_q=2.25人$

   病人在急诊室内外平均逗留时间： $W_s=60min$

   病人平均等候时间： $W_q=45min$



##### .m 文件

此文件中可以对 "总仿真时间" 及 $\lambda\ \mu$ 进行修改，总仿真时间针对的是有人员到达的时间长度；



#### M/M/S 模型

此模型与 M/M/1 模型不同之处在于有 S 个服务台，各服务台的工作相互独立，服务率相等，如果顾客到达时， S 个服务台都忙着，则排成一队等待，先到先服务的单队模型

此时整个系统的平均服务率为 $s\mu$ ，$\rho^*=\frac{\lambda}{s\mu}$ 为该系统的服务强度；==系统服务强度 < 1==

##### 状态概率

$$P_0=[\sum \limits_{k=0}^{S-1}\frac{1}{k!}(\frac{\lambda}{\mu})^k+\frac{1}{s!}\frac{1}{1-\rho^*}(\frac{\lambda}{\mu})^S]^{-1}$$

$$P_n=\begin{cases} \frac{1}{n!}(\frac{\lambda}{\mu})^nP_0,&0<n\leq S\\\frac{1}{S!S^{n-S}}(\frac{\lambda}{\mu})^nP_0,&n \geq S  \end{cases}$$



##### 主要运行指标

$$L_q=\frac{(S\rho^*)^S\rho^*}{S!(1-\rho^*)^2}P_0$$

$$L_s=L_q+s\rho^*$$

$$W_q=\frac{L_q}{\lambda}$$

$$W_s=\frac{L}{\lambda}=W_q+\frac{1}{\mu}$$



#### 系统状态 N >= S 的概率

$$P(N \geq k) = \sum \limits_{n=k}^\infty P_n=\frac{\rho^k}{k!(1-\rho^*)}P_0$$



##### 示例 2

承接上列，假设医院增加急诊室的服务能力，使其能够同时诊治两个病人，且平均服务率相同，试分析系统工作情况

分析：此时相当于增加一个服务台，故有： s = 2, $\lambda = 3人/h$ ， $\mu=4人/h$

此时 $\rho = 0.75$ ， $\rho^*=0.375$ ， $P_0=0.45$ ， $L_q=0.12人$ ， $L_s=0.87人$ ， $W_s = 17.4min$ ， $W_q=2.4min$

此时病人必须等候的概率，即系统状态 N >= 2 的概率：

$P(N \geq 2) \approx0.20$



##### .m 文件使用

对于具体案例，只需要修改 .m 文件前三行即可，第一行为服务台个数， $\mu$ 值大小， $\lambda$ 值大小



##### 示例 3

某医院挂号室有三个窗口，就诊者的到达服从泊松分布，平均到达率为每分钟 0.9 人，挂号员服务时间服从指数分布，平均服务率每分钟 0.4 人，现假设就诊者到达后排成一队，依次向空闲的窗口挂号。求该系统的运行指标与状态概率

分析：显然系统的容量和顾客源是不限的，属于 M/M/S 型的排队服务模型。

S = 3 ， $\rho = \frac{\lambda}{\mu}=\frac{0.9}{0.4}=2.25$ ， $\rho^*=\frac{\lambda}{s\mu}=2.25/3=3/4<1$

代入 .m 文件运算即可，但==需要注意单位==



### 线性规划模型

一般将求线性目标函数在线性约束条件下的最大值或最小值的问题称为线性规划问题。满足线性约束条件的解叫做可行解，由所有可行解组成的集合叫做可行域。决策变量、约束条件、目标函数是线性规划的三要素



##### 示例（通过 Lingo 软件求解）

某工厂拥有 a 、 b 两种原材料生产 A 、 B 两种产品，现有设备限量为 8 台时，已知每种产品的利润、所需设备台数及原材料的消耗如下表所示：

|              |  A   |  B   | 原材料总量 |
| :----------: | :--: | :--: | :--------: |
|    a(kg)     |  4   |  0   |     16     |
|    b(kg)     |  0   |  4   |     12     |
| 利润（万元） |  2   |  3   |            |
|  设备（台）  |  1   |  2   |            |

求解：在计划期内应如何安排计算才能使工厂获得的利润最大



分析：设 x1 、 x2 分别表示在计划期内产品 A 、 B 的产量，则所用设备有效台数应满足 x1 + 2x2 <= 8 ，同样，由于原材料的限量，可以得到 4x1 <= 16 ， 4x2 <= 12 ，因此，生产计划就是满足如下约束条件的一组变量 x1 、 x2 的值：

$$\begin{cases} x_1 + 2x_2 \leq 8\\ 4x_1 \leq 16\\4x_2 \leq 12\\x_1 \geq 0 \\ x_2 \geq 0\end{cases}$$

显然，可行的生产计划有限多个，现需要找到其利润最大，即求一组变量 x1 、 x2 的值，使其在满足约束条件的同时，使目标利润最大

将上述方程组放入至 ==lingo 软件==，点击 solve 即可

>   Global optimal solution found.   Objective value:                              14.00000   Infeasibilities:                              0.000000   Total solver iterations:                             1    Model Class:                                        LP    Total variables:                      2   Nonlinear variables:                  0   Integer variables:                    0    Total constraints:                    4   Nonlinear constraints:                0    Total nonzeros:                       6   Nonlinear nonzeros:                   0                                  Variable           Value        Reduced Cost                                       X1        4.000000            0.000000                                       X2        2.000000            0.000000                                       Row    Slack or Surplus      Dual Price                                        1        14.00000            1.000000                                        2        0.000000            1.500000                                        3        0.000000           0.1250000                                        4        4.000000            0.00 

通过运行结果可见，最优解为 14 ，此时 x1 为 4 ， x2 为 2



### 非线性规划与 01 规划模型

#### 非线性规划的 Lingo 求解

##### 示例

> Model: 
> max = 98 * x1 + 277 * x2 - x1 * x1 - 0.3 * x1 * x2 - 2 * x2 * x2;
> x1 + x2 < 100;
> x1 <= 2 * x2;
> @gin(x1);
> @gin(x2);
> end

上述代码中， Model 和 end 的作用是使结构更完整，没有其他作用，可以去掉

@gin 的作用是规定变量为整数

@bin 的作用是规定变量的值为 0 或 1

通过运行，得到以下答案，可知当 x1 = 35 且 x2 = 65 时，目标值最大为11077.5

>   Local optimal solution found.
>   Objective value:                              11077.50
>   Objective bound:                              11077.50
>   Infeasibilities:                              0.000000
>   Extended solver steps:                               2
>   Total solver iterations:                           215
>
>   Model Class:                                     PINLP
>
>   Total variables:                      2
>   Nonlinear variables:                  2
>   Integer variables:                    2
>
>   Total constraints:                    3
>   Nonlinear constraints:                1
>
>   Total nonzeros:                       6
>   Nonlinear nonzeros:                   2
>
> ```c
>                             Variable           Value        Reduced Cost
>                                   X1        35.00000           -8.500002
>                                   X2        65.00000           -6.500004
> 
>                                  Row    Slack or Surplus      Dual Price
>                                    1        11077.50            1.000000
>                                    2        0.000000            0.000000
>                                    3        95.00000            0.000000
> ```
>



#### 01 规划模型

是指未知量的取值范围只能是 0 或者 1 的规划问题，通常是线性规划

##### 示例

设有 A1 , A2 , A3, A4 四个人完成 B1， B2， B3 , B4四项工作，每人只能做一件工作且每件工作仅由一人担任， Ai 完成 Bj 所需时间为 Cij ，如下表所示

|      |  B1  |  B2  |  B3  |  B4  |
| :--: | :--: | :--: | :--: | :--: |
|  A1  |  8   |  13  |  18  |  23  |
|  A2  |  10  |  14  |  16  |  27  |
|  A3  |  2   |  10  |  21  |  26  |
|  A4  |  14  |  22  |  26  |  28  |

求解当指派哪个人去承担哪件工作时，才能使花的总时间最少



分析：

这个问题与上述示例有所不同，上述示例中所设变量都是问题中所要求的变量，而这个示例中需要引入的变量必须具有指定某人做某件工作，而其他人不能做该工作的作用。数字 0 和 1 就起到了这种作用，变量取 1 表示该人做该事，在总的花费时间内贡献时间，变量取 0 表示不做该事，从而在总的花费时间内不贡献时间

引入 16 个变量：

:hamburger:$$X_{ij}=\begin{cases} 1,&当指派 A_i 承担B_j工作时\\0,&当不指派A_i 承担 B_j工作时\end{cases}$$

从而得到如下条件：

> Model:
> Min=8x11+13*x12+18*x13+23*x14+10*x21+14*x22+16*x23+27*x24+2*x31+10*x32+21*x33+26*x34+14*x41+22*x42+26*x43+28*x44;
> x11+x12+x13+x14=1;
> x21+x22+x23+x24=1;
> x31+x32+x33+x34=1;
> x41+x42+x43+x44=1;
> x11+x21+x31+x41=1;
> x12+x22+x32+x42=1;
> x13+x23+x33+x43=1;
> x14+x24+x34+x44=1;
> end
> int16

上述代码中， int16 表示变量都为 2 个字节的带符号整数，从而保证不可能出现类似于 4 个 0.25 相加为 1 的情况

前四个式子表示每人只能做一件工作

后四个式子表示每件工作只能由一人完成

结果如下：目标值为 59 ；并且第 1 个人做第 2 件工作，第 2 个人做第 3 件工作，第 3 个人做第 1 件工作，第 4 个人做第 4 件工作

>   Global optimal solution found.
>   Objective value:                              59.00000
>   Infeasibilities:                              0.000000
>   Total solver iterations:                             8
>
>   Model Class:                                        LP
>
>   Total variables:                     16
>   Nonlinear variables:                  0
>   Integer variables:                    0
>
>   Total constraints:                    9
>   Nonlinear constraints:                0
>
>   Total nonzeros:                      48
>   Nonlinear nonzeros:                   0
>
> ```c
>                             Variable           Value        Reduced Cost
>                                  X11        0.000000            0.000000
>                                  X12        1.000000            0.000000
>                                  X13        0.000000            3.000000
>                                  X14        0.000000            1.000000
>                                  X21        0.000000            1.000000
>                                  X22        0.000000            0.000000
>                                  X23        1.000000            0.000000
>                                  X24        0.000000            4.000000
>                                  X31        1.000000            0.000000
>                                  X32        0.000000            3.000000
>                                  X33        0.000000            12.00000
>                                  X34        0.000000            10.00000
>                                  X41        0.000000            0.000000
>                                  X42        0.000000            3.000000
>                                  X43        0.000000            5.000000
>                                  X44        1.000000            0.000000
> 
>                                  Row    Slack or Surplus      Dual Price
>                                    1        59.00000           -1.000000
>                                    2        0.000000           -8.000000
>                                    3        0.000000           -9.000000
>                                    4        0.000000           -2.000000
>                                    5        0.000000           -14.00000
>                                    6        0.000000            0.000000
>                                    7        0.000000           -5.000000
>                                    8        0.000000           -7.000000
>                                    9        0.000000           -14.00000
> ```



### 主成分分析法

将多个变量通过线性变换以选出较少个数重要变量的一种多元统计分析方法



#### 主成分

由原始指标综合形成的几个新指标。依据主成分所含信息量的大小称为第一主成分、第二主成分等



#### 主成分与原始变量之间的关系

1. 主成分保留了原始变量绝大多数的信息
2. 主成分的数目大大少于原始变量的数目
3. 各个主成分之间互不相关
4. 每个主成分都是原始变量的线性组合



#### 方法简介

假设在讨论的实际问题中，有 p 个指标，将这 p 个指标看作 p 个随机变量，记为 $X_1,X_2...,X_p$ ，主成分分析就是要将这 p 个指标的问题转变为讨论 p 个指标线性组合的问题，而这些新的指标 $F_1,F_2,...,F_k（k\leq p）$ ，按照保留主要信息的原则充分反映原指标的信息，并且互相独立

这种将多个指标降为少数几个综合指标的过程在数学上称为降维；主成分分析通常的做法是寻求原指标的线性组合 Fi



#### 示例

通过 SPSS 软件打开相应的 EXCEL 文件

通过 分析 - 降维 - 因子选项，并将所有因素都导入到右侧；对于描述选项，添加 系数 一项；对于抽取选项，添加 碎石图 一项；对于得分选项，添加 显示因子得分系数矩阵 一项



##### 结果分析

1. 相关性矩阵

   得出各个因素之间的相关性

2. 解释的总方差（很关键）

   可以得出各个主成分所占比例及累计比例，当前几个主成分的累计比例达到一定程度时，可以代表其他因素

3. 碎石图

   也是对 "解释的总方差" 中的各个成分 "合计" 的展示，一般选取的主成分在碎石图中的特征值需要大于 1



##### 求指标对应的系数

此处，只选择了主成分 1 和 2 进行考虑（因为两者的累计比例较大，同时碎石图大于 1）

要求某个省份总的成分大小 F ，需要先求 F1 和 F2 ，在 F1 和 F2 中，对应的系数为成分矩阵中的数据除以主成分相对应的特征值开平方根之后的数值

如成分 1 的成分矩阵数据与处理之后的数值如下表：

| 0.949  | 0.353  |
| :----: | :----: |
| 0.112  | 0.042  |
| -0.109 | -0.041 |
| 0.978  | 0.364  |
| 0.986  | 0.367  |
| 0.983  | 0.366  |
| 0.947  | 0.352  |
| 0.977  | 0.364  |
| 0.800  | 0.298  |
| 0.954  | 0.355  |

具体操作如第 1 行：0.949 / sqrt(7.22) = 0.353

F1 = 0.353ZX1 + 0.042ZX2  - 0.041ZX3 + 0.364ZX4 + 0.367ZX5 + 0.366ZX6 + 0.352ZX7 + 0.364ZX8 + 0.298ZX9 + 0.355ZX10

F2 = 0.175ZX1 - 0.741ZX2 + 0.609ZX3 - 0.004ZX4 + 0.063ZX5 - 0.061ZX6 - 0.022ZX7 + 0.158ZX8 - 0.046ZX9 - 0.115ZX10

==注意，此处的 ZX1 - ZX10 都应是经过归一化处理后的数值，手动归一化处理请参考 "[属性值的归一化处理](#属性值的归一化处理)"章节，但 SPSS 软件中自带归一化处理方法，同时 F1 和 F2 在此例中只表示某个省份的主成分==

通过 分析 - 描述统计 - 描述选项，将所有因素都导入到右侧，并勾选 "将标准值另存为变量" ，此时原数据右侧将出现归一化处理之后的数据，并以 z 标记打头

此时，对于不同省份，将不同的 ZX1 - ZX10 数值，代入，便可求得不同的 F1 和 F2 数值，若需要求总的得分，需要按照加权平均的方法求出，由于 F1 占总成分 84.5 中的 72.2 ， F2 占总成分 84.5 中的 12.3，所以

F = (72.2 / 84.5) F1 + (12.3 / 84.5) F2

------

==以上方法中， F1 和 F2 的系数数值是通过变换求得，也可将 SPSS 软件给出的 "成分得分系数矩阵" 中的数值直接代入到公式中即可，但一般使用前一种方法较妥当==



### 聚类分析

实质是建立一种分类方法，使一批样本数据按照其在性质上的亲密程度在没有先验知识的情况下自动进行分类；这里的类便是一个具有相似性的个体的集合，不同类之间具有明显的区别

聚类分析是一种探索性的分析，在分类过程中，不必事先给出一个分类的标准，聚类分析能够从样本数据出发，自动进行分类。聚类分析所使用的方法不同，常常使结论不同。不同研究者对于同一组数据进行聚类分析，得到的聚类数未必已知，故称之为探索性的分析方法



#### 示例

案例仍为前一讲的例子，但此讲的目标是按照经济的相关性，对省份进行归类

通过 分析 - 分类 -系统聚类选项，将所有因素都导入至变量中，将需要分类的对象（地区）导入至 "个案标注依据中"；在 图 选项中勾选 谱系图；在 方法 选项中的聚类方法有多种，在实际问题中，可以多次选择进行对比分析



##### 分析方法

在谱系图（树状图）中添加垂直线，当添加在右侧时，垂直线只与两条水平线相交，下侧的线指向上海，上侧的线指向其他的城市，说明分为两类时，一类为上海，一类为其他城市；当垂直线向左水平移动时，将于三条水平线相交，下侧的线指向上海，中间的线指向辽宁，上侧的线指向其他城市，说明分为三类时分别为上海、辽宁、其他城市；对于左侧的几个格子，说明这几个城市应该为一类



对于冰柱图，应该从下往上看，相邻组颜色相同时说明为同一组，不同时说明为不同组，当逐渐向上观察时，不同组将逐渐汇成一个组



### 多元回归分析

回归分析是一种统计学上分析数据的方法，目的在于了解两个或多个变量间是否相关、相关方向与强度，并建立数学模型以便观察特定变量来预测研究者感兴趣的变量



#### 基本思想

虽然自变量和因变量之间没有严格的、准确性的函数关系，但可以设法找到最能代表它们之间关系的数学表达形式



#### 应用范围

收入水平与受教育程度、所在行业、工作年限、工作种类的关系

公路客运量与人口增长量、私家车保有量、国民生产总值、国民收入、铁路和水运客运量等因素的关系



#### 示例

以陕西省长武地区 1984 - 1995 年的蚜传病情资料、相关虫情和气象资料为例，剪力蚜传病毒病情指数的逐步回归模型，说明逐步回归分析的具体步骤。影响蚜传病毒病情指数的虫情因子和气象因子一共有 21 个，通过逐步回归，从中选出对病情指数影响显著的因子，从而建立相应的模型

通过 分析 - 回归 - 线性选项将 y 导入因变量，将 x1 - x21 导入自变量中，并且将 年份 导入至 个案标签中；在方法一栏，选中 步进 方法；在选项中，对 F 的概率进入设定为 0.15 ，除去设定为 0.20



##### 结果分析

在统计假设检验中，公认的小概率事件的概率值被称为统计假设检验的显著性水平，对同一量，进行多次计量，然后算出平均值。对于偏离平均值的正负差值，就是其不确定度。其差值越大，则计量的不确定性越大。在结果中，可以通过 ANOVA 表中的显著性水平一栏进行检验，本示例中可见显著性值都在 0.0001 数量级，非常小，所以可靠度很高

在可靠度满足要求的条件下，可通过 "系数" 表中的系数，得到回归方程，由于本示例中只分析了 4 个变量，故按照最后一栏，可得回归方程为 y = 2.492 + 0.009x15 + 0.034x4 - 0.235x7 - 0.003x5

